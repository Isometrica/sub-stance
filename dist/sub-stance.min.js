/*! sub-stance 2015-Sep-22 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(a,b,c){function d(a,b){function c(a,b){if(a.parent&&a.parent.data){var c=a.parent.data;c.$subs&&(a.data||(a.data={}),a.data.$subs?a.data.$subs=c.$subs.concat(a.data.$subs):a.data.$subs=c.$subs)}return b(a)}a.decorator("data",c)}function e(a,b,c,d){function e(a){return~a.indexOf(i)}function f(a,b){return _.map(a,function(a){if(_.isObject(a)){var c=_.extend({},a);return c.args=_.map(a.args,function(a){return b[a]}),c}return a})}function g(a){_.each(a.resolve,function(a,b){if(b!==i)if(_.isArray(a))e(a)||a.splice(a.length-1,0,i);else if(_.isFunction(a)){if(a.$inject){if(e(a.$inject))return}else a.$inject=[];a.$inject.push(i)}}),console.log("- Ensured deps",a.resolve),a.parent&&(console.log("- Parent: "+a.parent),g(d.get(a.parent))),console.log("- Finished traverse")}function h(a,d,e,h,j){return d.resolve?(d.resolve[i]=function(a){var b=f(d.data.$subs,e);return a.transition(b)},void g(d)):(c.warn("No resolve table for "+d.name+". You must at least add an empty object: .state({... resolve: {});"),void b.transition())}var i="$__subs";a.$on("$stateChangeStart",h)}function f(a,b){function c(a){return _.uniq(a,function(a){return a.hashKey})}function d(a){return _.map(a,function(a){var b;return b=_.isObject(a)?[a.name].concat(a.args):[a],{hashKey:b.join(","),args:b}})}return{_currentSubs:{},transition:function(e){var f=this,g=d(e);g=c(g);var h=f._migrate(g);return b.all(_.map(h,function(b){return a.subscribe.apply(a,b.args).then(function(a){f._currentSubs[b.hashKey]=a})}))},_migrate:function(a){var b=this,c=_.filter(a,function(a){return!_.some(b._currentSubs,function(b,c){return a.hashKey===c})});return _.each(b._currentSubs,function(c,d){_.some(a,function(a){return a.hashKey===d})||(c.stop(),delete b._currentSubs[d])}),c}}}b.module("isa.substance",["angular-meteor","ui.router"]),b.module("isa.substance").config(d).run(e),d.$inject=["$stateProvider"],e.$inject=["$rootScope","$subs","$log","$state"],b.module("isa.substance").service("$subs",f),f.$inject=["$meteor","$q"]}(window,window.angular);