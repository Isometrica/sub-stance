/*! sub-stance 2015-Sep-23 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(a,b,c){function d(a,b){return function(c){var d;return function(e,f,g){if(console.log("-- Transition"),d)return d=!1,void console.log("-- Locked, unlocking");console.log("-- Locking and performing operation"),e.preventDefault();var h=Array.prototype.slice.call(arguments);c.apply(null,h).then(function(){b.go(f,g)})["catch"](function(b){h.unshift("$asyncTransitionError"),h.push(b),a.$broadcast.apply(a,h)})["finally"](function(){d=!0})}}}function e(a,b){function c(a,b){var c=_.map(a,function(a){if(_.isObject(a)){var c=_.extend({},a);return c.args=_.map(a.args,function(a){return b[a]}),c}return a});return console.log("Evaluated conf",c),c}function d(a,b){if(a.parent&&a.parent.data){var c=a.parent.data;c.$subs&&(a.data||(a.data={}),a.data.$subs?a.data.$subs=c.$subs.concat(a.data.$subs):a.data.$subs=c.$subs)}return b(a)}function e(a,b,d){var e=a.transitionTo;return a.transitionTo=function(f,g){var h,i=Array.prototype.slice.call(arguments),j=a.get(f).data;return j&&(h=c(j.$subs,g)),b.transition(h).then(function(){return e.apply(a,i)})["catch"](function(a){d.$broadcast.call(d,"$subTransitionError",f,g,a)})},a}e.$inject=["$delegate","$subs","$rootScope"],b.decorator("$state",e),a.decorator("data",d)}function f(a,b){function c(a){return _.uniq(a,function(a){return a.hashKey})}function d(a){return _.map(a,function(a){var b;return b=_.isObject(a)?[a.name].concat(a.args):[a],{hashKey:b.join(","),args:b}})}return{_currentSubs:{},transition:function(e){var f=this,g=d(e);g=c(g);var h=f._migrate(g);return b.all(_.map(h,function(b){return a.subscribe.apply(a,b.args).then(function(a){f._currentSubs[b.hashKey]=a})}))},_migrate:function(a){var b=this,c=_.filter(a,function(a){return!b._currentSubs[a.hashKey]});return _.each(b._currentSubs,function(c,d){_.some(a,function(a){return a.hashKey===d})||(c.stop(),delete b._currentSubs[d])}),c}}}b.module("isa.substance",["angular-meteor","ui.router"]),b.module("isa.substance").service("$asyncTransition",d),d.$inject=["$rootScope","$state"],b.module("isa.substance").config(e),e.$inject=["$stateProvider","$provide"],b.module("isa.substance").service("$subs",f),f.$inject=["$meteor","$q"]}(window,window.angular);