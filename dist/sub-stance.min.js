/*! sub-stance 2015-Sep-21 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(a,b,c){function d(a,b){function c(a,b){if(a.parent&&a.parent.data){var c=a.parent.data;c.$subs&&(a.data||(a.data={}),a.data.$subs?a.data.$subs=c.$subs.concat(a.data.$subs):a.data.$subs=c.$subs)}return b(a)}a.decorator("data",c)}function e(a){function b(a,b,d,e,f){if(!b.resolve)throw new Error("No resolve table.");_.each(b.resolve,function(a){_.isArray(a)?a.splice(a.length-1,0,c):_.isFunction(a)&&(a.$inject||(a.$inject=[]),a.$inject.push(c))}),b.resolve[c]=["$subs",function(a){return a.transition(b.name,d)}]}var c="$__subs";a.$on("$stateChangeStart",b)}function f(){function a(a,b){return{_currentSubs:{},transition:function(c,d){var e=this,f=e._migrate(c,d);return b.all(_.map(f,function(b){return a.subscribe.apply(a,b.args).then(function(a){e._currentSubs[b.hashKey]=a})}))},_migrate:function(a,b){var d=this,e=c.get(a),f=_.map(e,function(a){return d._constructPayload(a,b)}),g=_.filter(f,function(a){return!_.some(d._currentSubs,function(b,c){return a.hashKey===c})});return _.each(d._currentSubs,function(a,b){_.some(f,function(a){return a.hashKey===b})||(a.stop(),delete d._currentSubs[b])}),g},_constructPayload:function(a,b){var c=[a.name].concat(_.map(a.params,function(a){return b[a]}));return{args:c,hashKey:c.join(",")}}}}var b=function(a){return _.isArray(a)||_.isFunction(a)?{autorun:a}:_.isObject(a)?{name:a.name,params:a.params}:{name:a,params:[]}},c={_subStates:{},state:function(a,c){var d=Array.prototype.slice.call(arguments),e=d.slice(1);return this._subStates[a]=_.map(e,b),this},get:function(a){return this._subStates[a]||[]}};_.extend(this,c),a.$inject=["$meteor","$q"],this.$get=a}b.module("isa.substance",["angular-meteor","ui.router"]),b.module("isa.substance").config(d).run(e),d.$inject=["$stateProvider"],e.$inject=["$rootScope"],b.module("isa.substance").provider("$subs",f)}(window,window.angular);